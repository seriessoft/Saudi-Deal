#!/usr/bin/env node
var Firebase = require('firebase');

var config = {
    apiKey: "AIzaSyCj1gTHtLAbAYXAxbxyzMHWRCbKihvzdH8",
    authDomain: "saudideal-922d4.firebaseapp.com",
    databaseURL: "https://saudideal-922d4.firebaseio.com",
    projectId: "saudideal-922d4",
    storageBucket: "saudideal-922d4.appspot.com",
    messagingSenderId: "820015895373"
};

Firebase.initializeApp(config);



var rootRef = Firebase.database().ref();
var lobbyData, lobbyTempData, unchangedLobbiesData;

rootRef.child('lobby').once('value').then(function(snapshot){
    lobbyData = snapshot;
    
    //rootRef.child('lobbyTemp').set(snapshot.val());
});

rootRef.child('lobbyTemp').once('value').then(function(snapshot){
    lobbyTempData = snapshot;
    
});

rootRef.child('unchangedLobbies').once('value').then(function(snapshot){
    unchangedLobbiesData = snapshot;
    
});

unchangedLobbiesData.forEach((lobby) => {
    rootRef.child('unchangedLobbies').child(lobby).once('value').then(function(snapshot){
        if(snapshot.val().counter >= 10){
            console.log(lobby + ' has not been changed since long');
            //edit here next time
        }
    });
    
});

lobbyData.forEach((lobby) => {
    if(lobby in lobbyTempData){
        if(lobbyData[lobby] == lobbyTempData[lobby]){
            if (lobby in unchangedLobbiesData){
                rootRef.child('unchangedLobbies').once('value').then(function(snapshot){
                    var counter = snapshot.val().counter + 1;
                    rootRef.child('unchangedLobbies').child(lobby).child('counter').set(counter);
                });
            } else{
               rootRef.child('unchangedLobbies').child(lobby).child('counter').set(1);  
            }
        } else{
            rootRef.child('unchangedLobbies').child(lobby).remove(); 
        }
    } else {
        rootRef.child('unchangedLobbies').child(lobby).child('counter').set(0);
    }
 });
    
rootRef.child('lobbyTemp').set(lobbyData.val());
    
    
console.log("AMMAR IS EATING AND BECOMING VERY Thin");
